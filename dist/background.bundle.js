(()=>{function e(e,t,o){chrome.tabs.sendMessage(e,{type:"showPrompt",selectedText:t},(e=>{if(e&&void 0!==e.additionalText){const s=e.additionalText,n=s?"".concat(s," ").concat(t):t;o(n)}else o(t)}))}function t(e,t){c(e,"Captured Text with Prompt: "+t),n(e,"Getting AI Response..."),s(e,t,(t=>{c(e,"AI Response: "+t),r(e,"AI Response: ".concat(t)),chrome.runtime.sendMessage({type:"openChat",message:t})}))}function o(){return window.getSelection().toString()||null}function s(e,t,o){fetch("http://localhost:5010/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationHistory:[{sender:"user",text:t}]})}).then((e=>e.json())).then((t=>{t&&t.response?o(t.response):(c(e,"Error: No response from AI"),r(e,"Error: No response from AI"))})).catch((t=>{console.error("Error sending text to AI:",t),c(e,"Error: Unable to contact AI server"),r(e,"Error: Unable to contact AI server")}))}function n(e,t){chrome.tabs.sendMessage(e,{type:"customAlert",message:t,loading:!0})}function r(e,t){chrome.tabs.sendMessage(e,{type:"customAlert",message:t,loading:!1})}function c(e,t){chrome.scripting.executeScript({target:{tabId:e},func:e=>console.log(e),args:[t]})}function i(e,t){chrome.tabs.sendMessage(e,{type:"customAlert",message:t,loading:!1})}chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"captureText",title:"Ask ClickAI about '%s'",contexts:["selection"]}),chrome.contextMenus.create({id:"addPromptAndCaptureText",title:"Add prompt and ask ClickAI about '%s'",contexts:["selection"]})})),chrome.contextMenus.onClicked.addListener(((a,d)=>{"captureText"===a.menuItemId?function(e,t){if(e.selectionText){const o=e.selectionText;c(t.id,"Captured Text: "+o),n(t.id,"Getting AI Response..."),s(t.id,o,(e=>{c(t.id,"AI Response: "+e),r(t.id,"AI Response: ".concat(e)),chrome.runtime.sendMessage({type:"openChat",message:e})}))}else chrome.scripting.executeScript({target:{tabId:t.id},function:o},(e=>{if(e&&e[0]&&e[0].result){const o=e[0].result;c(t.id,"Captured Text: "+o),n(t.id,"Getting AI Response..."),s(t.id,o,(e=>{c(t.id,"AI Response: "+e),r(t.id,"AI Response: ".concat(e)),chrome.runtime.sendMessage({type:"openChat",message:e})}))}else c(t.id,"Error: No text selected"),i(t.id,"Error: No text selected")}))}(a,d):"addPromptAndCaptureText"===a.menuItemId&&function(s,n){if(s.selectionText){const o=s.selectionText;e(n.id,o,(e=>{t(n.id,e)}))}else chrome.scripting.executeScript({target:{tabId:n.id},function:o},(o=>{if(o&&o[0]&&o[0].result){const s=o[0].result;e(n.id,s,(e=>{t(n.id,e)}))}else c(n.id,"Error: No text selected"),i(n.id,"Error: No text selected")}))}(a,d)})),chrome.runtime.onMessage.addListener(((e,t,o)=>{"openChat"===e.type&&chrome.storage.local.set({aiMessage:e.message},(()=>{chrome.action.setBadgeText({text:"NEW"}),chrome.action.setBadgeBackgroundColor({color:"#00FF00"})}))})),chrome.runtime.onMessage.addListener(((e,t,o)=>{"popupOpened"===e.type&&chrome.action.setBadgeText({text:""})}))})();
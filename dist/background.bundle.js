(()=>{function e(e,t,o){chrome.tabs.sendMessage(e,{type:"showPrompt",selectedText:t},(e=>{if(e&&void 0!==e.additionalText){const r=e.additionalText,s=r?"".concat(r," ").concat(t):t;o(s)}else o(t)}))}function t(e,t){c(e,"Captured Text with Prompt: "+t),s(e,"Getting AI Response..."),r(e,t,(t=>{c(e,"AI Response: "+t),n(e,"AI Response: ".concat(t)),chrome.runtime.sendMessage({type:"openChat",message:t})}))}function o(){return window.getSelection().toString()||null}function r(e,t,o){fetch("http://localhost:5010/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationHistory:[{sender:"user",text:t}]})}).then((e=>e.json())).then((t=>{t&&t.response?o(t.response):(c(e,"Error: No response from AI"),n(e,"Error: No response from AI"))})).catch((t=>{console.error("Error sending text to AI:",t),c(e,"Error: Unable to contact AI server"),n(e,"Error: Unable to contact AI server")}))}function s(e,t){chrome.tabs.sendMessage(e,{type:"customAlert",message:t,loading:!0})}function n(e,t){chrome.tabs.sendMessage(e,{type:"customAlert",message:t,loading:!1})}function c(e,t){chrome.scripting.executeScript({target:{tabId:e},func:e=>console.log(e),args:[t]})}function a(e,t){chrome.tabs.sendMessage(e,{type:"customAlert",message:t,loading:!1})}chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus.create({id:"captureText",title:"Ask ClickAI about '%s'",contexts:["selection"]}),chrome.contextMenus.create({id:"addPromptAndCaptureText",title:"Add prompt and ask ClickAI about '%s'",contexts:["selection"]}),chrome.contextMenus.create({id:"extractTextFromImage",title:"Extract Text and ask ClickAI",contexts:["image"]}),chrome.contextMenus.create({id:"addPromptAndExtractTextFromImage",title:"Add prompt and extract text from image",contexts:["image"]})})),chrome.contextMenus.onClicked.addListener(((i,d)=>{"captureText"===i.menuItemId?function(e,t){if(e.selectionText){const o=e.selectionText;c(t.id,"Captured Text: "+o),s(t.id,"Getting AI Response..."),r(t.id,o,(e=>{c(t.id,"AI Response: "+e),n(t.id,"AI Response: ".concat(e)),chrome.runtime.sendMessage({type:"openChat",message:e})}))}else chrome.scripting.executeScript({target:{tabId:t.id},function:o},(e=>{if(e&&e[0]&&e[0].result){const o=e[0].result;c(t.id,"Captured Text: "+o),s(t.id,"Getting AI Response..."),r(t.id,o,(e=>{c(t.id,"AI Response: "+e),n(t.id,"AI Response: ".concat(e)),chrome.runtime.sendMessage({type:"openChat",message:e})}))}else c(t.id,"Error: No text selected"),a(t.id,"Error: No text selected")}))}(i,d):"addPromptAndCaptureText"===i.menuItemId?function(r,s){if(r.selectionText){const o=r.selectionText;e(s.id,o,(e=>{t(s.id,e)}))}else chrome.scripting.executeScript({target:{tabId:s.id},function:o},(o=>{if(o&&o[0]&&o[0].result){const r=o[0].result;e(s.id,r,(e=>{t(s.id,e)}))}else c(s.id,"Error: No text selected"),a(s.id,"Error: No text selected")}))}(i,d):"extractTextFromImage"===i.menuItemId?function(e,t){const o=e.srcUrl;chrome.tabs.sendMessage(t.id,{type:"extractTextFromImage",imageUrl:o},(e=>{e&&e.extractedText?(console.log("Extracted Text: "+e.extractedText),r(t.id,e.extractedText,(e=>{c(t.id,"AI Response: "+e),n(t.id,"AI Response: ".concat(e)),chrome.runtime.sendMessage({type:"openChat",message:e})}))):(c(t.id,"Error: Failed to extract text from image"),a(t.id,"Error: Failed to extract text from image"))}))}(i,d):"addPromptAndExtractTextFromImage"===i.menuItemId&&function(o,r){const s=o.srcUrl;chrome.tabs.sendMessage(r.id,{type:"extractTextFromImage",imageUrl:s},(o=>{o&&o.extractedText?e(r.id,o.extractedText,(e=>{t(r.id,e)})):(c(r.id,"Error: Failed to extract text from image"),a(r.id,"Error: Failed to extract text from image"))}))}(i,d)})),chrome.runtime.onMessage.addListener(((e,t,o)=>{"openChat"===e.type&&chrome.storage.local.set({aiMessage:e.message},(()=>{chrome.action.setBadgeText({text:"NEW"}),chrome.action.setBadgeBackgroundColor({color:"#00FF00"})}))})),chrome.runtime.onMessage.addListener(((e,t,o)=>{"popupOpened"===e.type&&chrome.action.setBadgeText({text:""})}))})();